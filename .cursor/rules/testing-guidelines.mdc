---
alwaysApply: false
description: "ë“œëì‹­í•‘ ìë™í™” ì‹œìŠ¤í…œì˜ í…ŒìŠ¤íŠ¸ ì‘ì„± ê°€ì´ë“œë¼ì¸"
globs: "tests/**/*.py,src/tests/**/*.{ts,tsx}"
---

# í…ŒìŠ¤íŠ¸ ì‘ì„± ê°€ì´ë“œë¼ì¸

ë“œëì‹­í•‘ ìë™í™” ì‹œìŠ¤í…œì˜ ì•ˆì •ì„±ê³¼ í’ˆì§ˆì„ ë³´ì¥í•˜ê¸° ìœ„í•œ í…ŒìŠ¤íŠ¸ ì‘ì„± ê°€ì´ë“œë¼ì¸ì…ë‹ˆë‹¤.

## ğŸ§ª í…ŒìŠ¤íŠ¸ êµ¬ì¡°

### 1. í…ŒìŠ¤íŠ¸ íŒŒì¼ êµ¬ì¡°
```
tests/
â”œâ”€â”€ unit/                        # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ test_item_entity.py     # ë„ë©”ì¸ ì—”í‹°í‹° í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ test_product_service.py # ì„œë¹„ìŠ¤ ë¡œì§ í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ test_api_client.py      # API í´ë¼ì´ì–¸íŠ¸ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ integration/                 # í†µí•© í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ test_database.py        # ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ test_api_endpoints.py   # API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ test_full_workflow.py   # ì „ì²´ ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸
â””â”€â”€ e2e/                        # ì—”ë“œíˆ¬ì—”ë“œ í…ŒìŠ¤íŠ¸
    â””â”€â”€ test_user_journey.py    # ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
```

## ğŸ Python í…ŒìŠ¤íŠ¸ (pytest)

### 1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
```python
# tests/unit/test_product_service.py
import pytest
from unittest.mock import Mock, AsyncMock
from src.core.entities.item import Item, PricePolicy
from src.services.item_service import ItemService

class TestItemService:
    @pytest.fixture
    def mock_repository(self):
        """ëª¨ì˜ ë¦¬í¬ì§€í† ë¦¬"""
        mock = Mock()
        mock.get_item_by_id = AsyncMock(return_value=None)
        return mock

    @pytest.fixture
    def item_service(self, mock_repository):
        """í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì„œë¹„ìŠ¤"""
        return ItemService(repository=mock_repository)

    async def test_get_product_success(self, item_service, mock_repository):
        """ìƒí’ˆ ì¡°íšŒ ì„±ê³µ í…ŒìŠ¤íŠ¸"""
        # Given
        expected_item = Item(
            id="test_001",
            title="í…ŒìŠ¤íŠ¸ ìƒí’ˆ",
            price=PricePolicy(original_price=10000)
        )
        mock_repository.get_item_by_id = AsyncMock(return_value=expected_item)

        # When
        result = await item_service.get_product("test_001")

        # Then
        assert result.is_success()
        assert result.get_value().title == "í…ŒìŠ¤íŠ¸ ìƒí’ˆ"
        mock_repository.get_item_by_id.assert_called_once_with("test_001")

    async def test_get_product_not_found(self, item_service, mock_repository):
        """ìƒí’ˆ ì¡°íšŒ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸"""
        # Given
        mock_repository.get_item_by_id = AsyncMock(return_value=None)

        # When
        result = await item_service.get_product("nonexistent")

        # Then
        assert result.is_failure()
        assert "ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" in result.get_error()
```

### 2. í†µí•© í…ŒìŠ¤íŠ¸
```python
# tests/integration/test_api_endpoints.py
import pytest
from fastapi.testclient import TestClient
from src.app.main import create_app

class TestProductAPI:
    @pytest.fixture
    def client(self):
        """í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸"""
        app = create_app()
        return TestClient(app)

    def test_create_product_success(self, client):
        """ìƒí’ˆ ìƒì„± ì„±ê³µ í…ŒìŠ¤íŠ¸"""
        # Given
        product_data = {
            "title": "í…ŒìŠ¤íŠ¸ ìƒí’ˆ",
            "price": 10000,
            "supplier_id": "supplier_001"
        }

        # When
        response = client.post("/api/v1/products", json=product_data)

        # Then
        assert response.status_code == 201
        data = response.json()
        assert data["title"] == "í…ŒìŠ¤íŠ¸ ìƒí’ˆ"
        assert "id" in data

    def test_create_product_invalid_data(self, client):
        """ìƒí’ˆ ìƒì„± ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸"""
        # Given
        invalid_data = {
            "title": "",  # ë¹ˆ ì œëª©
            "price": -1000  # ìŒìˆ˜ ê°€ê²©
        }

        # When
        response = client.post("/api/v1/products", json=invalid_data)

        # Then
        assert response.status_code == 422  # Validation Error
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ í…ŒìŠ¤íŠ¸
```python
# tests/integration/test_database.py
import pytest
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from src.adapters.persistence.models import Base

class TestDatabaseIntegration:
    @pytest.fixture(scope="session")
    def engine(self):
        """í…ŒìŠ¤íŠ¸ìš© ë°ì´í„°ë² ì´ìŠ¤ ì—”ì§„"""
        engine = create_engine("sqlite:///./test.db", echo=False)
        Base.metadata.create_all(bind=engine)
        yield engine
        Base.metadata.drop_all(bind=engine)

    @pytest.fixture
    def db_session(self, engine):
        """í…ŒìŠ¤íŠ¸ìš© ë°ì´í„°ë² ì´ìŠ¤ ì„¸ì…˜"""
        SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
        with SessionLocal() as session:
            yield session

    def test_product_crud_operations(self, db_session):
        """ìƒí’ˆ CRUD ì—°ë™ í…ŒìŠ¤íŠ¸"""
        from src.adapters.persistence.repositories import ItemRepository
        from src.core.entities.item import Item, PricePolicy

        # Create
        repository = ItemRepository(db_session)
        test_item = Item(
            id="test_001",
            title="í…ŒìŠ¤íŠ¸ ìƒí’ˆ",
            price=PricePolicy(original_price=10000)
        )

        repository.save_item(test_item)

        # Read
        retrieved_item = repository.get_item_by_id("test_001")
        assert retrieved_item is not None
        assert retrieved_item.title == "í…ŒìŠ¤íŠ¸ ìƒí’ˆ"

        # Update
        test_item.title = "ìˆ˜ì •ëœ ìƒí’ˆ"
        repository.save_item(test_item)

        updated_item = repository.get_item_by_id("test_001")
        assert updated_item.title == "ìˆ˜ì •ëœ ìƒí’ˆ"
```

## âš›ï¸ React í…ŒìŠ¤íŠ¸ (Jest + Testing Library)

### 1. ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
```typescript
// src/components/__tests__/ProductList.test.tsx
import React from 'react';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { QueryClient, QueryClientProvider } from 'react-query';
import ProductList from '../ProductList';

// ëª¨ì˜ ë°ì´í„°
const mockProducts = [
  { id: '1', title: 'ìƒí’ˆ 1', price: 10000, status: 'active' },
  { id: '2', title: 'ìƒí’ˆ 2', price: 20000, status: 'inactive' },
];

const mockProps = {
  products: mockProducts,
  loading: false,
  onEdit: jest.fn(),
  onDelete: jest.fn(),
};

describe('ProductList', () => {
  let queryClient: QueryClient;

  beforeEach(() => {
    queryClient = new QueryClient({
      defaultOptions: {
        queries: { retry: false },
        mutations: { retry: false },
      },
    });
  });

  it('ìƒí’ˆ ëª©ë¡ì´ ì˜¬ë°”ë¥´ê²Œ ë Œë”ë§ë˜ëŠ”ì§€ í™•ì¸', () => {
    render(
      <QueryClientProvider client={queryClient}>
        <ProductList {...mockProps} />
      </QueryClientProvider>
    );

    expect(screen.getByText('ìƒí’ˆ 1')).toBeInTheDocument();
    expect(screen.getByText('ìƒí’ˆ 2')).toBeInTheDocument();
  });

  it('ìƒí’ˆ ìˆ˜ì • ë²„íŠ¼ì´ í´ë¦­ë˜ë©´ onEditê°€ í˜¸ì¶œë˜ëŠ”ì§€ í™•ì¸', async () => {
    render(
      <QueryClientProvider client={queryClient}>
        <ProductList {...mockProps} />
      </QueryClientProvider>
    );

    const editButton = screen.getAllByText('ìˆ˜ì •')[0];
    fireEvent.click(editButton);

    await waitFor(() => {
      expect(mockProps.onEdit).toHaveBeenCalledWith(mockProducts[0]);
    });
  });

  it('ë¡œë”© ìƒíƒœì—ì„œ ìŠ¤í”¼ë„ˆê°€ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸', () => {
    render(
      <QueryClientProvider client={queryClient}>
        <ProductList {...mockProps} loading={true} />
      </QueryClientProvider>
    );

    expect(screen.getByRole('img', { hidden: true })).toBeInTheDocument(); // Spin ì»´í¬ë„ŒíŠ¸
  });
});
```

### 2. í›… í…ŒìŠ¤íŠ¸
```typescript
// src/hooks/__tests__/useProducts.test.ts
import { renderHook, act } from '@testing-library/react-hooks';
import { QueryClient, QueryClientProvider } from 'react-query';
import { useProductsStore } from '../../stores/products';

// ëª¨ì˜ API
jest.mock('../../services/api', () => ({
  apiClient: {
    getProducts: jest.fn(),
  },
}));

describe('useProductsStore', () => {
  let queryClient: QueryClient;

  beforeEach(() => {
    queryClient = new QueryClient({
      defaultOptions: {
        queries: { retry: false },
        mutations: { retry: false },
      },
    });
  });

  it('ìƒí’ˆ ëª©ë¡ì„ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ”ì§€ í™•ì¸', async () => {
    const mockProducts = [
      { id: '1', title: 'ìƒí’ˆ 1', price: 10000 },
    ];

    const { apiClient } = require('../../services/api');
    apiClient.getProducts.mockResolvedValue({
      items: mockProducts,
      total: 1,
      page: 1,
      page_size: 20,
    });

    const wrapper = ({ children }: { children: React.ReactNode }) => (
      <QueryClientProvider client={queryClient}>
        {children}
      </QueryClientProvider>
    );

    const { result } = renderHook(() => useProductsStore(), { wrapper });

    // ì´ˆê¸° ìƒíƒœ í™•ì¸
    expect(result.current.products).toEqual([]);
    expect(result.current.loading).toBe(false);

    // ìƒí’ˆ ì¡°íšŒ ì•¡ì…˜ ì‹¤í–‰
    await act(async () => {
      await result.current.fetchProducts();
    });

    // ìƒíƒœ ë³€ê²½ í™•ì¸
    expect(result.current.products).toEqual(mockProducts);
    expect(result.current.loading).toBe(false);
  });
});
```

### 3. E2E í…ŒìŠ¤íŠ¸ (Cypress)
```typescript
// cypress/integration/product_management.spec.ts
describe('ìƒí’ˆ ê´€ë¦¬', () => {
  beforeEach(() => {
    cy.visit('/products');
  });

  it('ìƒí’ˆ ëª©ë¡ì´ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸', () => {
    cy.contains('ìƒí’ˆ ê´€ë¦¬').should('be.visible');
    cy.get('[data-testid="product-table"]').should('exist');
  });

  it('ìƒí’ˆì„ ìƒì„±í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸', () => {
    cy.get('[data-testid="add-product-btn"]').click();
    cy.get('[data-testid="product-form"]').should('be.visible');

    cy.get('[data-testid="product-name-input"]').type('ìƒˆ ìƒí’ˆ');
    cy.get('[data-testid="product-price-input"]').type('15000');
    cy.get('[data-testid="submit-btn"]').click();

    cy.contains('ìƒˆ ìƒí’ˆ').should('be.visible');
  });

  it('ìƒí’ˆì„ ê²€ìƒ‰í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸', () => {
    cy.get('[data-testid="search-input"]').type('ê¸°ì¡´ ìƒí’ˆ');
    cy.get('[data-testid="search-btn"]').click();

    cy.get('[data-testid="product-table"]').should('contain', 'ê¸°ì¡´ ìƒí’ˆ');
  });
});
```

## ğŸ”§ í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹°

### 1. í…ŒìŠ¤íŠ¸ ë°ì´í„° íŒ©í† ë¦¬
```python
# tests/fixtures/factories.py
from factory import Faker, SubFactory
from factory.alchemy import SQLAlchemyModelFactory
from src.adapters.persistence.models import Product, Supplier

class SupplierFactory(SQLAlchemyModelFactory):
    class Meta:
        model = Supplier

    name = Faker('company')
    description = Faker('text', max_nb_chars=200)
    is_active = True

class ProductFactory(SQLAlchemyModelFactory):
    class Meta:
        model = Product

    id = Faker('uuid4')
    title = Faker('word')
    supplier = SubFactory(SupplierFactory)
    price_data = '{"original_price": 10000, "margin_rate": 0.3}'
    is_active = True
```

### 2. API í…ŒìŠ¤íŠ¸ í—¬í¼
```python
# tests/helpers/api_helpers.py
from fastapi.testclient import TestClient
from typing import Dict, Any

class APIHelper:
    def __init__(self, client: TestClient):
        self.client = client

    def create_product(self, product_data: Dict[str, Any]) -> Dict[str, Any]:
        """ìƒí’ˆ ìƒì„± í—¬í¼"""
        response = self.client.post("/api/v1/products", json=product_data)
        assert response.status_code == 201
        return response.json()

    def get_products(self, params: Dict[str, Any] = None) -> Dict[str, Any]:
        """ìƒí’ˆ ëª©ë¡ ì¡°íšŒ í—¬í¼"""
        response = self.client.get("/api/v1/products", params=params or {})
        assert response.status_code == 200
        return response.json()

    def authenticate(self, username: str, password: str) -> str:
        """ì¸ì¦ í—¬í¼"""
        response = self.client.post("/api/v1/auth/login", json={
            "username": username,
            "password": password
        })
        assert response.status_code == 200
        return response.json()["access_token"]
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ í…ŒìŠ¤íŠ¸ í—¬í¼
```python
# tests/helpers/db_helpers.py
from sqlalchemy.orm import Session
from src.adapters.persistence.models import Base
from tests.fixtures.factories import ProductFactory, SupplierFactory

def setup_test_database(session: Session):
    """í…ŒìŠ¤íŠ¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •"""
    # í…Œì´ë¸” ìƒì„±
    Base.metadata.create_all(bind=session.bind)

    # í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
    supplier = SupplierFactory()
    products = ProductFactory.create_batch(5, supplier=supplier)

    session.add_all([supplier] + products)
    session.commit()

    return {
        "supplier": supplier,
        "products": products
    }

def cleanup_test_database(session: Session):
    """í…ŒìŠ¤íŠ¸ ë°ì´í„°ë² ì´ìŠ¤ ì •ë¦¬"""
    Base.metadata.drop_all(bind=session.bind)
```

## ğŸ“Š í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€

### ì»¤ë²„ë¦¬ì§€ ëª©í‘œ
```python
# pytest.ini ë˜ëŠ” pyproject.toml
[tool.coverage.run]
source = ["src"]
omit = [
    "*/tests/*",
    "*/migrations/*",
    "*/__pycache__/*",
]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "raise AssertionError",
    "raise NotImplementedError",
]
```

### ì»¤ë²„ë¦¬ì§€ í™•ì¸
```bash
# ì»¤ë²„ë¦¬ì§€ ì‹¤í–‰
pytest --cov=src --cov-report=html --cov-report=term

# HTML ë¦¬í¬íŠ¸ ì—´ê¸°
open htmlcov/index.html
```

## ğŸš€ CI/CD í…ŒìŠ¤íŠ¸

### GitHub Actions
```yaml
# .github/workflows/tests.yml
name: Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      - name: Run tests
        run: |
          pytest --cov=src --cov-report=xml
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v1
```

### Docker í…ŒìŠ¤íŠ¸
```dockerfile
# Dockerfile.test
FROM python:3.9-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
RUN pip install pytest pytest-cov

CMD ["pytest", "--cov=src", "--cov-report=html", "--cov-report=term"]
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ëª¨ë²” ì‚¬ë¡€

### 1. í…ŒìŠ¤íŠ¸ ê²©ë¦¬
```python
# âœ… ì¢‹ì€ ì˜ˆì‹œ - ê° í…ŒìŠ¤íŠ¸ê°€ ë…ë¦½ì 
class TestProductService:
    def test_create_product(self, db_session):
        # Given
        repository = ItemRepository(db_session)

        # When
        result = await repository.save_item(test_item)

        # Then
        assert result.is_success()

    def test_get_product(self, db_session):
        # Given
        repository = ItemRepository(db_session)
        await repository.save_item(test_item)

        # When
        result = await repository.get_item_by_id(test_item.id)

        # Then
        assert result.title == test_item.title
```

### 2. ì˜ë¯¸ìˆëŠ” í…ŒìŠ¤íŠ¸ëª…
```python
# âœ… ì¢‹ì€ ì˜ˆì‹œ
def test_user_can_create_order_with_valid_data():
def test_order_total_is_calculated_correctly():
def test_product_becomes_unavailable_when_stock_is_zero():

# âŒ ë‚˜ìœ ì˜ˆì‹œ
def test_function1():
def test_case_1():
def test_123():
```

### 3. Arrange-Act-Assert íŒ¨í„´
```python
def test_product_creation():
    # Arrange - í…ŒìŠ¤íŠ¸ ì¤€ë¹„
    repository = MockRepository()
    test_item = Item(id="1", title="Test")

    # Act - ì‹¤í–‰
    result = await repository.save_item(test_item)

    # Assert - ê²€ì¦
    assert result.is_success()
    assert repository.was_called()
```

### 4. ì—ì§€ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸
```python
def test_product_with_empty_title_should_fail():
def test_product_with_negative_price_should_fail():
def test_order_with_no_items_should_fail():
def test_concurrent_updates_should_be_handled():
```

ì´ ê°€ì´ë“œë¼ì¸ì„ ë”°ë¼ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”.