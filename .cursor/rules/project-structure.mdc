---
alwaysApply: true
description: "ë“œëì‹­í•‘ ìë™í™” ì‹œìŠ¤í…œì˜ í”„ë¡œì íŠ¸ êµ¬ì¡° ê°€ì´ë“œ"
globs: "**/*"
---

# í”„ë¡œì íŠ¸ êµ¬ì¡° ê°€ì´ë“œ

ë“œëì‹­í•‘ ìë™í™” ì‹œìŠ¤í…œì€ **í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜(Hexagonal Architecture)**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

## ğŸ“ í”„ë¡œì íŠ¸ ë£¨íŠ¸ êµ¬ì¡°

```
fast_16/
â”œâ”€â”€ src/                          # ì†ŒìŠ¤ ì½”ë“œ (í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜)
â”‚   â”œâ”€â”€ app/                      # FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ (í”„ë ˆì„ ê³„ì¸µ)
â”‚   â”‚   â”œâ”€â”€ main.py              # FastAPI ì•± ìƒì„± ë° ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ routes/              # HTTP ë¼ìš°íŠ¸ (DTO ë³€í™˜ë§Œ)
â”‚   â”‚   â”œâ”€â”€ di.py                # ì˜ì¡´ì„± ì£¼ì… ì„¤ì •
â”‚   â”‚   â””â”€â”€ middleware.py        # ë¯¸ë“¤ì›¨ì–´ (ë¡œê¹…, CORS ë“±)
â”‚   â”œâ”€â”€ core/                    # ë„ë©”ì¸ (ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™)
â”‚   â”‚   â”œâ”€â”€ entities/            # ìˆœìˆ˜ ë„ë©”ì¸ ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ usecases/            # ë¹„ì¦ˆë‹ˆìŠ¤ ìœ ì¦ˆì¼€ì´ìŠ¤
â”‚   â”‚   â””â”€â”€ ports/               # ì¸í„°í˜ì´ìŠ¤ (ì¶”ìƒí™”)
â”‚   â”œâ”€â”€ adapters/                # ì–´ëŒ‘í„° (ì™¸ë¶€ ì‹œìŠ¤í…œ êµ¬í˜„)
â”‚   â”‚   â”œâ”€â”€ suppliers/           # OwnerClan, ë„ë§¤ë§¤ ë“± ê³µê¸‰ì‚¬
â”‚   â”‚   â”œâ”€â”€ markets/             # ì¿ íŒ¡, ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ë“± ë§ˆì¼“
â”‚   â”‚   â”œâ”€â”€ persistence/         # ë°ì´í„°ë² ì´ìŠ¤, ë¦¬í¬ì§€í† ë¦¬
â”‚   â”‚   â””â”€â”€ auth/                # í† í° ì €ì¥ì†Œ
â”‚   â”œâ”€â”€ presentation/            # DTO, ê²€ì¦ ìŠ¤í‚¤ë§ˆ
â”‚   â”œâ”€â”€ services/                # íŒŒì‚¬ë“œ ì„œë¹„ìŠ¤ (íŠ¸ëœì­ì…˜ ê²½ê³„)
â”‚   â””â”€â”€ shared/                  # ê³µìœ  ì„¤ì •, ë¡œê¹…, ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ frontend/                    # React TypeScript í”„ëŸ°íŠ¸ì—”ë“œ
â”œâ”€â”€ scripts/                     # ê°œë°œ/ìš´ì˜ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ docs/                        # ë¬¸ì„œ ë° ë°ì´í„°
â””â”€â”€ tests/                       # í…ŒìŠ¤íŠ¸ ì½”ë“œ
```

## ğŸ—ï¸ í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜ ì›ì¹™

### 1. ì˜ì¡´ì„± ë°©í–¥ (ì•ˆìª½ â†’ ë°”ê¹¥ìª½)
```
í”„ë ˆì„(app) â†’ ë„ë©”ì¸(core) â†’ ì–´ëŒ‘í„°(adapters)
```

- **app**: HTTP ìš”ì²­/ì‘ë‹µ, DTO ë³€í™˜ë§Œ ë‹´ë‹¹
- **core**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ë„ë©”ì¸ ê·œì¹™
- **adapters**: ì™¸ë¶€ ì‹œìŠ¤í…œ(DB, API, íŒŒì¼ ë“±) ì—°ë™

### 2. í¬íŠ¸ì™€ ì–´ëŒ‘í„° íŒ¨í„´
- **í¬íŠ¸(Port)**: ì¸í„°í˜ì´ìŠ¤ ì •ì˜ (`core/ports/`)
- **ì–´ëŒ‘í„°(Adapter)**: í¬íŠ¸ êµ¬í˜„ì²´ (`adapters/`)

### 3. ë ˆì´ì–´ ê°„ í†µì‹ 
- ê° ë ˆì´ì–´ëŠ” ìì‹ ì˜ ì±…ì„ë§Œ ìˆ˜í–‰
- ìƒìœ„ ë ˆì´ì–´ëŠ” í•˜ìœ„ ë ˆì´ì–´ë¥¼ ì˜ì¡´ì„± ì£¼ì…ìœ¼ë¡œ ì‚¬ìš©
- ì§ì ‘ ì˜ì¡´ì„± ì£¼ì…ì€ `app/di.py`ì—ì„œ ê´€ë¦¬

## ğŸ“ ì½”ë”© ê°€ì´ë“œë¼ì¸

### 1. íŒŒì¼ëª… ê·œì¹™
- **ì—”í‹°í‹°**: `src/core/entities/{domain}_entity.py`
- **ìœ ì¦ˆì¼€ì´ìŠ¤**: `src/core/usecases/{action}_{domain}.py`
- **í¬íŠ¸**: `src/core/ports/{domain}_port.py`
- **ì–´ëŒ‘í„°**: `src/adapters/{category}/{provider}_adapter.py`
- **ë¼ìš°íŠ¸**: `src/app/routes/{domain}.py`
- **ì„œë¹„ìŠ¤**: `src/services/{domain}_service.py`

### 2. ì„í¬íŠ¸ ê·œì¹™
```python
# âœ… ì˜¬ë°”ë¥¸ ì„í¬íŠ¸ (ë‚´ë¶€ì—ì„œ ì™¸ë¶€ë¡œ)
from src.core.entities.item import Item
from src.core.ports.supplier_port import SupplierPort
from src.adapters.persistence.repositories import ItemRepository

# âŒ ì˜ëª»ëœ ì„í¬íŠ¸ (ìƒìœ„ì—ì„œ í•˜ìœ„ë¡œ)
from app.main import app  # appì—ì„œ core ì„í¬íŠ¸ ê¸ˆì§€
```

### 3. ì—ëŸ¬ ì²˜ë¦¬
```python
from src.shared.result import Result, Success, Failure

# âœ… Result íŒ¨í„´ ì‚¬ìš©
def some_business_logic() -> Result[Item, str]:
    try:
        # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
        return Success(item)
    except Exception as e:
        return Failure(f"ì˜¤ë¥˜: {str(e)}")
```

### 4. ë¡œê¹…
```python
from src.shared.logging import get_logger

logger = get_logger(__name__)

# âœ… êµ¬ì¡°í™”ëœ ë¡œê¹…
logger.info("ìƒí’ˆ ë™ê¸°í™” ì‹œì‘", extra={"supplier_id": "123"})
logger.error("API í˜¸ì¶œ ì‹¤íŒ¨", extra={"error_code": 500, "url": "https://api.example.com"})
```

## ğŸ”§ ê°œë°œ ì›Œí¬í”Œë¡œìš°

### 1. ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€
1. **ë„ë©”ì¸ ëª¨ë¸** ì •ì˜ (`core/entities/`)
2. **í¬íŠ¸(ì¸í„°í˜ì´ìŠ¤)** ì •ì˜ (`core/ports/`)
3. **ìœ ì¦ˆì¼€ì´ìŠ¤** êµ¬í˜„ (`core/usecases/`)
4. **ì–´ëŒ‘í„°** êµ¬í˜„ (`adapters/`)
5. **ë¼ìš°íŠ¸** ì¶”ê°€ (`app/routes/`)
6. **í…ŒìŠ¤íŠ¸** ì‘ì„±

### 2. API ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
```python
# app/routes/example.py
@router.post("/items")
async def create_item(request: ItemCreateRequest):
    result = await item_service.create_item(request)
    if result.is_success():
        return ItemResponse(**result.get_value())
    raise HTTPException(status_code=400, detail=result.get_error())
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ ë³€ê²½
1. **ëª¨ë¸ ì—…ë°ì´íŠ¸** (`adapters/persistence/models.py`)
2. **ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±** (`alembic revision --autogenerate`)
3. **ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰** (`alembic upgrade head`)

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê°€ì´ë“œë¼ì¸

### 1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
```python
# tests/unit/test_item_entity.py
def test_item_creation():
    item = Item(id="1", title="Test", price=PricePolicy(...))
    assert item.is_available() == True
```

### 2. í†µí•© í…ŒìŠ¤íŠ¸
```python
# tests/integration/test_api.py
async def test_product_sync_api():
    response = await client.post("/api/v1/products/ingest", json={...})
    assert response.status_code == 200
```

### 3. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
# ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
python -m pytest src/tests/unit/ -v

# í†µí•© í…ŒìŠ¤íŠ¸
python -m pytest src/tests/integration/ -v

# ì „ì²´ í…ŒìŠ¤íŠ¸
python -m pytest src/tests/ -v
```

## ğŸ“š ì¶”ê°€ ë¦¬ì†ŒìŠ¤

- **API ë¬¸ì„œ**: `http://localhost:8000/docs`
- **README**: í”„ë¡œì íŠ¸ ê°œìš” ë° ì„¤ì¹˜ ê°€ì´ë“œ
- **í™˜ê²½ë³€ìˆ˜**: `.env.example` íŒŒì¼ ì°¸ê³ 
- **ë°ì´í„°ë² ì´ìŠ¤**: `alembic/` í´ë”ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ë“¤